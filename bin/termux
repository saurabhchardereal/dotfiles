#!/data/data/com.termux/files/usr/bin/bash
#
# SPDX-License-Identifier: MIT
#
# Copyright (C) 2020-2021 Saurabh Charde <saurabhchardereal@gmail.com>
#

CONFIG_DIR="$(dirname "$(readlink -f "${BASH_SOURCE[0]}")")"/..
source "$CONFIG_DIR"/dotfiles/zsh/functions/utils
source "$CONFIG_DIR"/scripts/git-setup.sh

# Update package lists and update packages
pkg update -y && pkg upgrade -y

# Packages to install
pr_info "Installing packages ..."
pkg install --no-install-recommends -y \
    antibody \
    clang \
    gh \
    gnupg \
    jq \
    ncurses-utils \
    neovim \
    nodejs \
    openssh \
    sheldon \
    zsh

# Theme
setup_theme() {
    # use Dracula color scheme & Hack font by default
    pr_info "Setting up theme ..."
    curl -Lso "$HOME"/.termux/colors.properties https://raw.githubusercontent.com/saurabhchardereal/env/main/etc/Dracula-termux.properties
    curl -Lso "$HOME"/.termux/font.ttf https://github.com/saurabhchardereal/env/raw/main/etc/Hack.ttf
}

# Settings I use for moi setup
[[ ! -d ~/.termux ]] && mkdir ~/.termux
echo "extra-keys = [['ESC','/','-','HOME','UP','END','PGUP'],['TAB','CTRL','ALT','LEFT','DOWN','RIGHT','PGDN']]" >~/.termux/termux.properties
setup_theme
git_setup

# Setup dotfiles
pr_info "Setting up dotfiles ..."
mkdir "${HOME}"/{.config,.sheldon}
echo "export ZDOTDIR=~/.config/zsh" >"${HOME}"/.zshenv
ln -sf "$CONFIG_DIR"/dotfiles/zsh "${HOME}"/.config/zsh
ln -sf "$CONFIG_DIR"/dotfiles/nvim "${HOME}"/.config/nvim
ln -sf "$CONFIG_DIR"/dotfiles/zsh/plugins.toml "${HOME}"/.sheldon

# Switch to zsh
chsh -s zsh

pr_succ "Setup done!"
